= render 'shared/side_nav'
.main
  .filter
    %select#select-school.noborder.selectpicker
      %option{:value => ""}
        ជ្រើសរើសសាលា ...
      - @schools.each do |school|
        - if school[:id] == params[:school]
          %option{:value => school[:id], :selected => "selected"}
            = school[:name]
        - else
          %option{:value => school[:id]}
            = school[:name]
    %select#select-grade.noborder.selectpicker
      %option{:value => ""}
        ជ្រើសរើសថ្នាក់ ...
      - @grades.each do |grade|
        - if grade == params[:grade]
          %option{:value => grade, :selected => "selected"}
            = grade
        - else
          %option{:value => grade}
            = grade
  %br
  %table.table-bordered.table.central{style: "width:80%;", align: "center"}
    %thead
      %tr
        %th{width: 60} #
        %th សិស្ស
        %th ភេទ
        %th ថ្នាក់ទី
        %th ឈ្មោះសាលា
        %th ការធ្វើតេស្ត

    %tbody
      - @users.each do |user|
        %tr
          %td= link_to user.id, user_path(user.id)
          %td= link_to user.full_name, user_path(user.id)
          %td= user.sex
          %td= user.grade
          %td= user.school_name
          %td
            - user.games.each_with_index do |game, i|
              %div
                = "តេស្តលើកទី #{i + 1}: តេស្តស្វែងយល់អំពីខ្លួនឯង (តេស្ត #{game.personal_understandings.length}ដង, ធ្លាក់ "
                - fails_len = game.personal_understandings.fails.length
                %span{ class: ("dangerous" if fails_len > 1)}
                  = fails_len
                = "ដង)"

  %div{style: 'text-align: center'}= paginate @users
